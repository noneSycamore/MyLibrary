
# python 简单计算器的实现
## 前言啦

用python的tkinter库建的一个计算器，基本功能参照微软的，再加了一点个人感兴趣的扩展模块...
讲真看起来貌似有点臃肿...



## 系统设计

以下内容，实际上就是简单的流程而已...

首先设计简单计算器的功能，在此基础上加入各个扩展。编程语言采用python，调用python的图形库tkinter设计图形界面，调用math库实现开方、三角、对数运算以及e和π值的确定.

运算及连续计算实现：通过点击放置的按钮将对应的数字和运算符号加入到字符串内，并在文本框显示。单击“=”进行计算，将字符串切片，利用条件判断的方式得到对应的表达形式，调用eval()函数直接执行，并将其计算结果重新赋给该字符串，从而使计算结果能够参与到后续运算，若出现计算表达格式等错误，显示“Error”报错.

清空、撤退功能实现：清空即清除当前字符串的内容并显示，撤退即对字符串切片，选取最后一个字符以前的内容并显示.



## 扩展添加

贷款计算器实现：通过单击对应按钮进入对应的程序流程。用文本框接收输入的贷款年限、贷款金额、贷款利率等数据，读取等额本息、等额本金的单选框，用flag变量记录选择的选项，单击计算按钮调用函数，通过flag变量判断并调用对应的计算函数。先后计算出每月还款、总还款金额、总利息，用文本框接收计算值并显示.

Base64加解密实现：单击加密按钮后，用base64库的加密函数加密字符串内容并将结果显示，单击解密按钮后，用base64库的解密函数解密，并将结果转化为字符串显示，保证解密内容可以参与后续计算.

RSA加解密实现：单击RSA按钮，跳转到对应的界面。单击”生成公钥/私钥“按钮随机生成密钥并base64加密后显示，用文本框接收加密/解密的文本，单击公钥、私钥加密及私钥解密按钮对文本进行对应运算，显示结果
(偷懒啦，直接调用的库).



## 运行界面

一共四个界面：

1.简单计算器

![](https://cdn.jsdelivr.net/gh/noneSycamore/whitzard_cdn/wp-content/uploads/2021/09/图片-1.png)

2.扩展

![](https://cdn.jsdelivr.net/gh/noneSycamore/whitzard_cdn/wp-content/uploads/2021/09/图片-2.png)

3.贷款计算器

![](https://cdn.jsdelivr.net/gh/noneSycamore/whitzard_cdn/wp-content/uploads/2021/09/图片-3.png)

4.RSA 加解密

![](https://cdn.jsdelivr.net/gh/noneSycamore/whitzard_cdn/wp-content/uploads/2021/09/图片-4.png)

## 代码实现

```
<pre class="wp-block-code">```
# coding: utf-8

from tkinter import *
from math import *
import rsa
import base64

class myMortgage:
    docstring for myMortgage
    def __init__(self):
        window = Tk()
        window.title(myMortgage)

        self.amountVar = StringVar()  # 贷款金额
        self.rateVar = StringVar()  # 年化利率
        self.yearsVar = StringVar()  # 贷款年限
        self.total_Var = StringVar()  # 总还款额
        self.totalInterest_Var = StringVar()  # 总利息
        self.monthRepayment_Var = StringVar()  # 第i月应还
        self.flag = IntVar()  #判断等额本息本金

        self.flag=1

        frame = Frame(window)
        frame.pack(padx=20, pady=20)
        
        iv_default = IntVar()
        Radiobutton(frame, width=6, text=等额本息,value=1, variable=iv_default, command=self.judge_1).grid(row=1, column=2, sticky=W)
        Radiobutton(frame, width=6, text=等额本金,value=2, variable=iv_default, command=self.judge_2).grid(row=1, column=3, sticky=W)
        iv_default.set(1)

        Label(frame,text=还款方式:).grid(row=1,column=1,sticky='w')
        Label(frame, text=贷款年限(年):).grid(row=2, column=1,sticky='w')
        Label(frame, text=贷款金额(万元):).grid(row=3, column=1,sticky='w')
        Label(frame, text=贷款利率(%):).grid(row=4, column=1,sticky='w')

        Label(frame, text=月均还款(元):).grid(row=6, column=1,sticky='w')
        Label(frame, text=利息总额(元):).grid(row=7, column=1,sticky='w')
        Label(frame, text=还款总额(元):).grid(row=8, column=1,sticky='w')

        Entry(frame, textvariable=self.amountVar).grid(row=3, column=2)
        Entry(frame, textvariable=self.rateVar).grid(row=4, column=2)
        Entry(frame, textvariable=self.yearsVar).grid(row=2, column=2)

        Entry(frame, textvariable=self.total_Var).grid(row=8, column=2, sticky=E)
        Entry(frame, textvariable=self.totalInterest_Var).grid(row=7, column=2, sticky=E)
        Entry(frame, textvariable=self.monthRepayment_Var).grid(row=6, column=2, sticky=E)

        Button(frame, width=10, text=计算, command=self.calculate).grid(row=5, column=1, pady=0)
        Button(frame, width=10, text=重新计算, command=self.recalculate).grid(row=5, column=2, pady=0)

        window.mainloop()
    def judge_1(self):
        self.flag=1
    def judge_2(self):
        self.flag=2

    def calculate(self):
    	if(self.flag==1):
    		self.calculate_1()
    	if(self.flag==2):
    		self.calculate_2()
    def recalculate(self):
    	if(self.flag==1):
    		self.calculate_1()
    	if(self.flag==2):
    		self.calculate_2()

    def calculate_1(self):
        amount = eval(self.amountVar.get()) * 10000
        rate = eval(self.rateVar.get()) / 100 / 12  # 将年化利率转为月利率，单位为1
        years = eval(self.yearsVar.get())

        # 计算每月还款
        monthRepayment = amount * rate * ((1 + rate ) ** (years * 12)) / ((1 + rate ) ** (years * 12) - 1)

        # 将计算结果设置给控件
        total = monthRepayment * 12 * years  # 总还款金额
        self.total_Var.set(format(total, .3f))

        totalInterest = total - amount  # 总利息
        self.totalInterest_Var.set(format(totalInterest, '.3f'))
        self.monthRepayment_Var.set(format(monthRepayment, '.3f'))


    def calculate_2(self):
        amount = eval(self.amountVar.get()) * 10000
        rate = eval(self.rateVar.get()) / 100 / 12  # 将年化利率转为月利率，单位为1
        years = eval(self.yearsVar.get())
        month_amount = amount / (years * 12)

        # 存储每月还款
        monthRepayment = []
        for i in range(1, (years * 12) + 1):
            monthpayment = month_amount + (amount - (i - 1) * month_amount) * rate
            monthRepayment.append(monthpayment)

        # 将计算结果设置给控件
        total = sum(monthRepayment)
        self.total_Var.set(format(total, .3f))

        totalInterest = total - amount
        self.totalInterest_Var.set(format(totalInterest, '.3f'))
        self.monthRepayment_Var.set(format(total/12, '.3f'))

def RSA():
    def GenerateKey():
    	(public_key, private_key) = rsa.newkeys(1024)
    	#print(\n生成公钥：+public_key.save_pkcs1().decode('utf8'))
    	#print(\n生成私钥：+private_key.save_pkcs1().decode('utf8'))
    	publicKeyText.delete(0.0, END)
    	publicKeyText.insert(END, public_key.save_pkcs1().decode('utf8'))
    
    	privateKeyText.delete(0.0, END)
    	privateKeyText.insert(END, private_key.save_pkcs1().decode('utf8'))

    def EncryptionByPublickey():           #用公钥加密
    	public_key_str = publicKeyText.get(0.0, end).encode(encoding=utf-8)
    	public_key = rsa.PublicKey.load_pkcs1(public_key_str)
    
    	entry_str = entryText.get(0.0, end).encode(encoding=utf-8)
    
    	encrypt_msg = rsa.encrypt(entry_str, public_key)
    	#print(公钥加密后的文本为：\n+base64.encodebytes(encrypt_msg).decode('utf8'))
    	outputText.delete(0.0, END)
    	outputText.insert(END, base64.encodebytes(encrypt_msg).decode('utf8'))
    
    def EncryptionByPrivatekey(): 
    	private_key_str = privateKeyText.get(0.0, end).encode(encoding=utf-8)
    	private_key = rsa.PrivateKey.load_pkcs1(private_key_str)
    
    	entry_str = entryText.get(0.0, end).encode(encoding=utf-8)
    
    	encrypt_msg = rsa.encrypt(entry_str, private_key)
    	#print(私钥加密后的文本为：\n+base64.encodebytes(encrypt_msg).decode('utf8'))
    	outputText.delete(0.0, END)
    	outputText.insert(END, base64.encodebytes(encrypt_msg).decode('utf8'))  

    def DecryptionByPrivatekey(): 
    	private_key_str = privateKeyText.get(0.0, end).encode(encoding=utf-8)
    	private_key = rsa.PrivateKey.load_pkcs1(private_key_str)
    	
    	entry_str = entryText.get(0.0, end).encode(encoding=utf-8)
    	encrypt_msg = base64.decodebytes( entry_str)
    	outputText.delete(0.0, END)
    	
    	try:
    	    decrypt_msg = rsa.decrypt(encrypt_msg, private_key)
    	    #print(私钥解密后的文本为：\n+decrypt_msg.decode('utf8'))
    	    outputText.insert(END,decrypt_msg.decode('utf8'))
    	except:
    	    decrypt_msg = 私钥解密失败
    	    #print(decrypt_msg)
    	    outputText.insert(END,decrypt_msg)
    window = Tk()    
    window.title(RSA加解密计算器)

    frame = Frame(window)
    frame.pack()

    label = Label(frame, text = 公钥(已base64)：)
    label.grid(row = 1, column = 1,columnspan= 4)

    publicKeyText = Text(frame,width=50,height=8)
    publicKeyText.grid(row = 2, column = 1,columnspan = 4)

    label = Label(frame, text = 私钥(已base64)：)
    label.grid(row = 3, column = 1,columnspan= 4)

    privateKeyText = Text(frame,width=50,height=12)
    privateKeyText.grid(row = 4, column = 1,columnspan = 4)

    btGenerateKey = Button(frame, text = 生成公钥/私钥,command=GenerateKey)
    btGenerateKey.grid(row = 5, column = 1,columnspan = 4)

    label = Label(frame, text = 请输入加密/解密的文本:)
    label.grid(row = 6, column = 1,columnspan = 4)

    entryText = Text(frame,width=50,height=5)
    entryText.grid(row = 7, column = 1,columnspan = 4)

    btEncryptionByPublickey = Button(frame, text = 公钥加密,command=EncryptionByPublickey)
    btEncryptionByPublickey.grid(row = 8, column = 1,columnspan=2,pady = 10)

    btEncryptionByPrivatekey = Button(frame, text = 私钥加密,command=EncryptionByPrivatekey)
    btEncryptionByPrivatekey.grid(row = 8, column = 3)

    btDecryptionByPrivatekey = Button(frame, text = 私钥解密,command=DecryptionByPrivatekey)
    btDecryptionByPrivatekey.grid(row = 8, column = 4)

    outputText = Text(frame,width=50,height=5)
    outputText.grid(row = 9, column = 1,columnspan = 4)

    GenerateKey();
    mainloop()

class myCalculator:
    docstring for myCalculator
    def __init__(self, master):
        self.master = master
        self.initWidgets()
        self.hi = None
    def initWidgets(self):
        self.show = Label(relief=SUNKEN, font=('Courier New', 24),width=23, bg='white', anchor=W)
        self.show.pack(side=TOP, pady=10)
        self.p = Frame(self.master)
        self.p.pack(side=TOP)

        names = ( 清空 , <- , ** , sqrt
        		, 1 , 2 , 3 , + , // 
            	, 4 , 5 , 6 , - , %
            	, 7 , 8 , 9 , * , =
            	, 0 , . , / , myMortgage <-,->export,(,))

        for i in range(4):
        	if(i == 0):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=9,bg='orange')
        		b.grid(row=0,column=0,columnspan=2)
        		b.bind('<Button-1>', self.clean)
        	if(i == 1):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='orange')
        		b.grid(row=0,column=2)
        		b.bind('<Button-1>', self.delete)
        	if(i == 2):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        		b.grid(row = 0 , column = 3)
        		b.bind('<Button-1>', self.click)
        	if(i == 3):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        		b.grid(row = 0 , column = 4,)
        		b.bind('<Button-1>', self.Sqrt)
        for i in range(4,9):
        	if(i == 7 or i == 8):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	else:
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='orange')
        	b.grid(row = 1 , column = (i-4) % 5,)
        	b.bind('<Button-1>', self.click)
        for i in range(9,14):
        	if(i == 12 or i == 13):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	else:
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='orange')
        	b.grid(row = 2 , column = (i-4) % 5,)
        	b.bind('<Button-1>', self.click)
        for i in range(14,19):
        	if(i == 17 or i == 18):
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	else:
        		b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='orange')
        	if(i == 18):break
        	b.grid(row = 3 , column = (i-4) % 5,)
        	b.bind('<Button-1>', self.click)
        if(i == 18):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=4, height=3,bg='light green')
        	b.grid(row=3,column=4,rowspan=2)
        	b.bind('<Button-1>', self.click)
        	i+=1
        if(i == 19):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=9,bg='orange')
        	b.grid(row=4,column=0,columnspan=2)
        	b.bind('<Button-1>', self.click)
        for i in range(20,23):
        	if(i == 22):break
        	if(i == 20):b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='orange')
        	if(i == 21):b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	b.grid(row = 4 , column = (i-3) % 5,)
        	b.bind('<Button-1>', self.click)
        if(i == 22):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=14,bg='LemonChiffon')
        	b.grid(row = 5 , column = 0 , columnspan=3 , sticky = e)
        	b.bind('<Button-1>', self.Mortgage)
        	i +=1
        if (i == 23):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=10,bg='Thistle')
        	b.grid(row = 6 , column = 2 , columnspan=3 , sticky = e)
        	b.bind('<Button-1>',self.extra_func)
        	i +=1
        if(i == 24):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	b.grid(row = 5 , column = 3 , columnspan=1 , sticky = e)
        	b.bind('<Button-1>', self.click)
        	i +=1
        if(i == 25):
        	b = Button(self.p, text=names[i], font=('Verdana', 20), width=4,bg='light blue')
        	b.grid(row = 5 , column = 4 , columnspan=1 , sticky = e)
        	b.bind('<Button-1>', self.click)

        self.i = 0

    def click(self, event):
        try:
            if(event.widget['text'] in ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '.')):
            	self.show['text'] = self.show['text'] + event.widget['text']
            	self.i = self.i + 1

            elif(event.widget['text'] in ('+', '-', '*', '/', '%', '**', '//', '(', ')')):
            	self.show['text'] = self.show['text'] + event.widget['text']

            elif(event.widget['text'] == '=' and self.show['text'] is not None):
            	if(self.show['text'] != ''):
            		self.hi = self.show['text']
            		if('base' in self.hi):
            			num=self.hi.find(')')
            			base=self.hi.find('=')
            			self.show['text'] = str(eval(self.hi[:num] + , + self.hi[base+1:] + )))
            		else:
            			self.show['text'] = str(eval(self.hi))
            	self.hi = None
            	self.i = 0
        except:
        	self.show['text'] = Error
    
    def Sqrt(self,event):
    	self.show['text'] = 'sqrt(' + self.show['text'] + ')'

    def Ln(self,event):
    	self.show['text'] = 'log(' + self.show['text'] + ',e)'

    def Log(self,event):
    	self.show['text'] = 'log(' + self.show['text'] + '),base='

    def num_e(self,event):
    	self.show['text'] = self.show['text'] + e

    def num_pi(self,event):
    	self.show['text'] = self.show['text'] + pi

    def Sin(self,event):
    	self.show['text'] = sin( + self.show['text'] + )
    def Cos(self,event):
    	self.show['text'] = cos( + self.show['text'] + )
    def Tan(self,event):
    	self.show['text'] = tan( + self.show['text'] + )
    def Asin(self,event):
    	self.show['text'] = asin( + self.show['text'] + )
    def Acos(self,event):
    	self.show['text'] = acos( + self.show['text'] + )
    def Atan(self,event):
    	self.show['text'] = atan( + self.show['text'] + )

    def clean(self, event):
    	self.hi = None
    	self.show['text'] = ''

    def delete(self,event):
    	self.show['text'] = self.show['text'][:-1]	

    def base64_en(self,event):
    	try:
    		self.show['text'] = base64.b64encode(bytes(self.show['text'].encode()))
    	except:
    		self.show['text'] = base64.b64encode(self.show['text'])

    def base64_de(self,event):
    	try:
    		self.show['text'] = base64.b64decode(self.show['text']).decode()
    	except:
    		self.show['text'] = base64 decode failed

    def Mortgage(self,event):
    	self.master.destroy()
    	myMortgage()
    def Rsa(self,event):
    	#self.master.destroy()
    	RSA()

    def extra_func(self,event):
    	b = Button(self.p, text=ln, font=('Verdana', 20), width=6,bg='light blue')
    	b.grid(row = 0 , column =5)
    	b.bind('<Button-1>',self.Ln)
    	b = Button(self.p, text=log, font=('Verdana', 20), width=6,bg='light blue')
    	b.grid(row = 0 , column =6)
    	b.bind('<Button-1>',self.Log)
    	b = Button(self.p, text=e, font=('Verdana', 20), width=6,bg='orange')
    	b.grid(row = 1 , column =5)
    	b.bind('<Button-1>',self.num_e)
    	b = Button(self.p, text=π, font=('Verdana', 20), width=6,bg='orange')
    	b.grid(row = 1 , column =6)
    	b.bind('<Button-1>',self.num_pi)
    	b = Button(self.p, text=sin, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 2 , column =5,columnspan=3,sticky=W)
    	b.bind('<Button-1>',self.Sin)
    	b = Button(self.p, text=cos, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 2 , column =5,columnspan=3)
    	b.bind('<Button-1>',self.Cos)
    	b = Button(self.p, text=tan, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 2 , column =5,columnspan=3,sticky=E)
    	b.bind('<Button-1>',self.Tan)
    	b = Button(self.p, text=asin, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 3 , column =5,columnspan=3,sticky=W)
    	b.bind('<Button-1>',self.Asin)
    	b = Button(self.p, text=acos, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 3 , column =5,columnspan=3)
    	b.bind('<Button-1>',self.Acos)
    	b = Button(self.p, text=atan, font=('Verdana', 20), width=4,bg='light blue')
    	b.grid(row = 3 , column =5,columnspan=3,sticky=E)
    	b.bind('<Button-1>',self.Atan)
    	b = Button(self.p, text=b64加, font=('Verdana', 20), width=6,bg='Silver')
    	b.grid(row = 4 , column = 5 , sticky = w)
    	b.bind('<Button-1>', self.base64_en)
    	b = Button(self.p, text=b64解, font=('Verdana', 20), width=6,bg='Silver')
    	b.grid(row = 4 , column = 6 , sticky = e)
    	b.bind('<Button-1>', self.base64_de)
    	b = Button(self.p, text=-> RSA, font=('Verdana', 20), width=12,bg='Silver',command=RSA)
    	b.grid(row = 5 , column = 5, columnspan=3)

root = Tk()
myCalculator(root)
root.title(myCalculator)
root.mainloop()
```
